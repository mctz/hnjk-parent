(function(a){jQuery.fn.extend({uploadPreview:function(d){d=jQuery.extend({width:0,height:0,imgDiv:"#imgDiv",imgType:["gif","jpeg","jpg","bmp","png"],callback:function(){return false}},d||{});var b=this;var e=a(this);var c=a(d.imgDiv);c.width(d.width);c.height(d.height);autoScaling=function(){if(a.browser.version=="7.0"||a.browser.version=="8.0"){c.get(0).filters.item("DXImageTransform.Microsoft.AlphaImageLoader").sizingMethod="image"}var f=c.width();var j=c.height();if(f>0&&j>0){var g=(d.width/f<d.height/j)?d.width/f:d.height/j;if(g<=1){if(a.browser.version=="7.0"||a.browser.version=="8.0"){c.get(0).filters.item("DXImageTransform.Microsoft.AlphaImageLoader").sizingMethod="scale"}c.width(f*g);c.height(j*g)}else{c.width(f);c.height(j)}var i=(d.width-c.width())*0.5;var h=(d.height-c.height())*0.5;c.css({"margin-left":i,"margin-top":h});c.show()}};e.change(function(){if(this.value){if(!RegExp(".("+d.imgType.join("|")+")$","i").test(this.value.toLowerCase())){alert("图片类型不符合要求!");this.value="";return false}c.hide();if(a.browser.msie){if(a.browser.version=="6.0"){var f=a("<img />");c.replaceWith(f);c=f;var h=new Image();h.src="file:///"+this.value;c.attr("src",h.src);autoScaling()}else{c.css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=image)"});c.get(0).filters.item("DXImageTransform.Microsoft.AlphaImageLoader").sizingMethod="image";try{c.get(0).filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=this.value}catch(g){alert("无效的图片文件！");return}setTimeout("autoScaling()",100)}}else{var f=a("<img />");c.replaceWith(f);c=f;c.attr("src",this.files.item(0).getAsDataURL());c.css({"vertical-align":"middle"});setTimeout("autoScaling()",100)}}})}})})(jQuery);